<!DOCTYPE html>  <html> <head>   <title>sample19.php</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               sample19.php             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cp">&lt;?php</span>
</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p><i>This sample will show how to use <b>Compare</b> method from ComparisonApi to return a URL representing a single page of a Document</i></p>             </td>             <td class="code">               <div class="highlight"><pre>

</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Set variables and get POST data</h3>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">F3</span><span class="o">::</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;userId&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="nx">F3</span><span class="o">::</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;privateKey&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="nx">f3</span><span class="o">::</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="nv">$clientId</span> <span class="o">=</span> <span class="nx">F3</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;POST[&quot;client_id&quot;]&#39;</span><span class="p">);</span>
    <span class="nv">$privateKey</span> <span class="o">=</span> <span class="nx">F3</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;POST[&quot;private_key&quot;]&#39;</span><span class="p">);</span>
    <span class="nv">$sourceFileId</span> <span class="o">=</span> <span class="nx">f3</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;POST[&quot;sourceFileId&quot;]&#39;</span><span class="p">);</span>
    <span class="nv">$targetFileId</span> <span class="o">=</span> <span class="nx">f3</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;POST[&quot;targetFileId&quot;]&#39;</span><span class="p">);</span>
    <span class="nv">$callbackUrl</span> <span class="o">=</span> <span class="nx">f3</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;POST[&quot;callbackUrl&quot;]&#39;</span><span class="p">);</span>
    <span class="nv">$basePath</span> <span class="o">=</span> <span class="nx">f3</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;POST[&quot;server_type&quot;]&#39;</span><span class="p">);</span>
       
    <span class="k">function</span> <span class="nf">Compare</span><span class="p">(</span><span class="nv">$clientId</span><span class="p">,</span> <span class="nv">$privateKey</span><span class="p">,</span> <span class="nv">$sourceFileId</span><span class="p">,</span> <span class="nv">$targetFileId</span><span class="p">,</span> <span class="nv">$callbackUrl</span><span class="p">,</span> <span class="nv">$basePath</span><span class="p">)</span>
    <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h3>Check clientId, privateKey and fileGuId</h3>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$clientId</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$privateKey</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$sourceFileId</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$targetFileId</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">&#39;Please enter all required parameters&#39;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Set variables for Viewer</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nx">F3</span><span class="o">::</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;userId&#39;</span><span class="p">,</span> <span class="nv">$clientId</span><span class="p">);</span>
            <span class="nx">F3</span><span class="o">::</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;privateKey&#39;</span><span class="p">,</span> <span class="nv">$privateKey</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h3>Create Signer, ApiClient and Storage Api objects</h3>             </td>             <td class="code">               <div class="highlight"><pre>

</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Create signer object</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nv">$signer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GroupDocsRequestSigner</span><span class="p">(</span><span class="nv">$privateKey</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Create apiClient object</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nv">$apiClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">APIClient</span><span class="p">(</span><span class="nv">$signer</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Create ComparisonApi object</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nv">$CompareApi</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ComparisonApi</span><span class="p">(</span><span class="nv">$apiClient</span><span class="p">);</span>
            <span class="nv">$CompareApi</span><span class="o">-&gt;</span><span class="na">setBasePath</span><span class="p">(</span><span class="nv">$basePath</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h3>Make request to ComparisonApi using user id</h3>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nv">$CompareApi</span><span class="o">-&gt;</span><span class="na">setBasePath</span><span class="p">(</span><span class="nv">$basePath</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Comparison of documents where: $clientId - user GuId, $sourceFileId - source file Guid in which will be provided compare, 
$targetFileId - file GuId with wich will compare sourceFile, $callbackUrl - Url which will be executed after compare,</p>             </td>             <td class="code">               <div class="highlight"><pre>
            
            <span class="nv">$info</span> <span class="o">=</span> <span class="nv">$CompareApi</span><span class="o">-&gt;</span><span class="na">Compare</span><span class="p">(</span><span class="nv">$clientId</span><span class="p">,</span> <span class="nv">$sourceFileId</span><span class="p">,</span> <span class="nv">$targetFileId</span><span class="p">,</span> <span class="nv">$callbackUrl</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>Example of handling callback request:</h3>

<p>You can handle callback request in separate php file or in the same one. Our service will post JSON data via post request. 
In PHP you should get raw data like this:
    $json = file<em>get</em>contents("php://input"); - get callback data
    $fp = fopen(<strong>DIR</strong> . '/../../temp/signature<em>request</em>log.txt', 'a'); - open file for data write
    fwrite($fp, $json . "\r\n"); - write data to the file
    fclose($fp); - close file</p>             </td>             <td class="code">               <div class="highlight"><pre>
            
</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Check request status</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="k">if</span><span class="p">(</span><span class="nv">$info</span><span class="o">-&gt;</span><span class="na">status</span> <span class="o">==</span> <span class="s2">&quot;Ok&quot;</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Create AsyncApi object</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="nv">$asyncApi</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AsyncApi</span><span class="p">(</span><span class="nv">$apiClient</span><span class="p">);</span>
                <span class="nv">$asyncApi</span><span class="o">-&gt;</span><span class="na">setBasePath</span><span class="p">(</span><span class="nv">$basePath</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h3>Check job status</h3>             </td>             <td class="code">               <div class="highlight"><pre>
                                
                <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Delay necessary that the inquiry would manage to be processed</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="nb">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>                    
</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Make request to api for get document info by job id</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="nv">$jobInfo</span> <span class="o">=</span> <span class="nv">$asyncApi</span><span class="o">-&gt;</span><span class="na">GetJobDocuments</span><span class="p">(</span><span class="nv">$clientId</span><span class="p">,</span> <span class="nv">$info</span><span class="o">-&gt;</span><span class="na">result</span><span class="o">-&gt;</span><span class="na">job_id</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Check job status, if status is Completed or Archived exit from cycle</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="k">if</span> <span class="p">(</span><span class="nv">$jobInfo</span><span class="o">-&gt;</span><span class="na">result</span><span class="o">-&gt;</span><span class="na">job_status</span> <span class="o">==</span> <span class="s2">&quot;Completed&quot;</span> <span class="o">||</span> <span class="nv">$jobInfo</span><span class="o">-&gt;</span><span class="na">result</span><span class="o">-&gt;</span><span class="na">job_status</span> <span class="o">==</span> <span class="s2">&quot;Archived&quot;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">break</span><span class="p">;</span>
</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>If job status Postponed throw exception with error</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$jobInfo</span><span class="o">-&gt;</span><span class="na">result</span><span class="o">-&gt;</span><span class="na">job_status</span> <span class="o">==</span> <span class="s2">&quot;Postponed&quot;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">&#39;Job is failure&#39;</span><span class="p">);</span>
                    <span class="p">}</span>
                    
                <span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Get file guid</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="nv">$guid</span> <span class="o">=</span> <span class="nv">$jobInfo</span><span class="o">-&gt;</span><span class="na">result</span><span class="o">-&gt;</span><span class="na">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">guid</span><span class="p">;</span>
</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Construct iframe using fileId</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="k">if</span><span class="p">(</span><span class="nv">$basePath</span> <span class="o">==</span> <span class="s2">&quot;https://api.groupdocs.com/v2.0&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$iframe</span> <span class="o">=</span> <span class="s1">&#39;https://apps.groupdocs.com/document-viewer/embed/&#39;</span> <span class="o">.</span> <span class="nv">$guid</span> <span class="o">.</span> <span class="s1">&#39; frameborder=&quot;0&quot; width=&quot;500&quot; height=&quot;650&quot;&#39;</span><span class="p">;</span>
</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>iframe to dev server</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="p">}</span> <span class="k">elseif</span><span class="p">(</span><span class="nv">$basePath</span> <span class="o">==</span> <span class="s2">&quot;https://dev-api.groupdocs.com/v2.0&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$iframe</span> <span class="o">=</span> <span class="s1">&#39;https://dev-apps.groupdocs.com/document-viewer/embed/&#39;</span> <span class="o">.</span> <span class="nv">$guid</span> <span class="o">.</span> <span class="s1">&#39; frameborder=&quot;0&quot; width=&quot;500&quot; height=&quot;650&quot;&#39;</span><span class="p">;</span>
</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>iframe to test server</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="p">}</span> <span class="k">elseif</span><span class="p">(</span><span class="nv">$basePath</span> <span class="o">==</span> <span class="s2">&quot;https://stage-api.groupdocs.com/v2.0&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$iframe</span> <span class="o">=</span> <span class="s1">&#39;https://stage-apps.groupdocs.com/document-viewer/embed/&#39;</span> <span class="o">.</span> <span class="nv">$guid</span> <span class="o">.</span> <span class="s1">&#39; frameborder=&quot;0&quot; width=&quot;500&quot; height=&quot;650&quot;&#39;</span><span class="p">;</span>
                <span class="p">}</span>

            <span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>If request was successfull - set url variable for template</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="k">return</span> <span class="nx">F3</span><span class="o">::</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;iframe&#39;</span><span class="p">,</span> <span class="nv">$iframe</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">try</span> <span class="p">{</span>
         <span class="nx">Compare</span><span class="p">(</span><span class="nv">$clientId</span><span class="p">,</span> <span class="nv">$privateKey</span><span class="p">,</span> <span class="nv">$sourceFileId</span><span class="p">,</span> <span class="nv">$targetFileId</span><span class="p">,</span> <span class="nv">$callbackUrl</span><span class="p">,</span> <span class="nv">$basePath</span><span class="p">);</span>
        
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="s1">&#39;ERROR: &#39;</span> <span class="o">.</span>  <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="nx">f3</span><span class="o">::</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nv">$error</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Process template</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">f3</span><span class="o">::</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;sourceFileId&#39;</span><span class="p">,</span> <span class="nv">$sourceFileId</span><span class="p">);</span>
    <span class="nx">f3</span><span class="o">::</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;targetFileId&#39;</span><span class="p">,</span> <span class="nv">$targetFileId</span><span class="p">);</span>
    <span class="nx">f3</span><span class="o">::</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;callbackURL&#39;</span><span class="p">,</span> <span class="nv">$callbackUrl</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>f3::set('result', $result);</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="k">echo</span> <span class="nx">Template</span><span class="o">::</span><span class="na">serve</span><span class="p">(</span><span class="s1">&#39;sample19.htm&#39;</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 